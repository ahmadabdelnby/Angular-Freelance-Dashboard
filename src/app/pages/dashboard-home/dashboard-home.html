<div class="dashboard-home">
  <!-- Loading State -->
  <div *ngIf="loading">
    <app-loader [size]="'large'" [message]="'Loading Dashboard Statistics...'"></app-loader>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="alert alert-danger" role="alert">
    {{ error }}
    <button class="btn btn-sm btn-outline-danger ms-3" (click)="loadStatistics()">
      <i class="bi bi-arrow-clockwise"></i> Retry
    </button>
  </div>

  <!-- Statistics Dashboard -->
  <div *ngIf="statistics && !loading" class="container-fluid">
    <div class="row mb-4">
      <div class="col-12">
        <h2 class="mb-0">Dashboard Overview</h2>
        <p class="text-muted">Platform statistics and insights</p>
      </div>
    </div>

    <!-- Stats Cards -->
    <div class="row g-4 mb-4">
      <!-- Total Users -->
      <div class="col-xl-3 col-md-6">
        <div class="card stat-card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="flex-shrink-0">
                <div class="stat-icon bg-primary bg-opacity-10 text-primary">
                  <i class="bi bi-people-fill"></i>
                </div>
              </div>
              <div class="flex-grow-1 ms-3">
                <p class="text-muted mb-1 small">Total Users</p>
                <h3 class="mb-0">{{ statistics.users?.total || 0 }}</h3>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Total Jobs -->
      <div class="col-xl-3 col-md-6">
        <div class="card stat-card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="flex-shrink-0">
                <div class="stat-icon bg-success bg-opacity-10 text-success">
                  <i class="bi bi-briefcase-fill"></i>
                </div>
              </div>
              <div class="flex-grow-1 ms-3">
                <p class="text-muted mb-1 small">Total Jobs</p>
                <h3 class="mb-0">{{ statistics.jobs?.total || 0 }}</h3>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Total Contracts -->
      <div class="col-xl-3 col-md-6">
        <div class="card stat-card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="flex-shrink-0">
                <div class="stat-icon bg-info bg-opacity-10 text-info">
                  <i class="bi bi-file-earmark-text-fill"></i>
                </div>
              </div>
              <div class="flex-grow-1 ms-3">
                <p class="text-muted mb-1 small">Active Contracts</p>
                <h3 class="mb-0">{{ statistics.contracts?.total || 0 }}</h3>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Total Revenue -->
      <div class="col-xl-3 col-md-6">
        <div class="card stat-card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex align-items-center">
              <div class="flex-shrink-0">
                <div class="stat-icon bg-warning bg-opacity-10 text-warning">
                  <i class="bi bi-currency-dollar"></i>
                </div>
              </div>
              <div class="flex-grow-1 ms-3">
                <p class="text-muted mb-1 small">Total Revenue</p>
                <h3 class="mb-0">${{ (statistics.revenue?.total || 0) | number:'1.2-2' }}</h3>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Charts Row -->
    <div class="row g-4">
      <!-- User Growth Chart -->
      <div class="col-lg-8">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-4">
              <h5 class="card-title mb-0">User Growth Trend</h5>
              <div class="d-flex gap-2 align-items-center">
                <select class="form-select form-select-sm" style="width: auto;" 
                        [(ngModel)]="selectedRange" 
                        (change)="onRangeChange()">
                  <option value="7days">Last 7 Days</option>
                  <option value="30days">Last 30 Days</option>
                  <option value="3months">Last 3 Months</option>
                  <option value="6months" selected>Last 6 Months</option>
                  <option value="year">Last Year</option>
                  <option value="custom">Custom Range</option>
                </select>
                
                <div *ngIf="selectedRange === 'custom'" class="d-flex gap-2">
                  <input type="date" class="form-control form-control-sm" 
                         [(ngModel)]="customStartDate"
                         (change)="onCustomDateChange()"
                         style="width: 150px;">
                  <span class="align-self-center">to</span>
                  <input type="date" class="form-control form-control-sm" 
                         [(ngModel)]="customEndDate"
                         (change)="onCustomDateChange()"
                         style="width: 150px;">
                </div>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="userGrowthChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Jobs Status Chart -->
      <div class="col-lg-4">
        <div class="card border-0 shadow-sm h-100">
          <div class="card-body">
            <h5 class="card-title mb-4">Jobs Distribution</h5>
            <div class="chart-container">
              <canvas id="jobsChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Revenue Chart -->
    <div class="row g-4 mt-2">
      <div class="col-12">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h5 class="card-title mb-4">Revenue Overview</h5>
            <div class="chart-container">
              <canvas id="revenueChart"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Stats -->
    <div class="row g-4 mt-2">
      <div class="col-md-4">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h6 class="text-muted mb-3">Proposals</h6>
            <h4 class="mb-0">{{ statistics.proposals?.total || 0 }}</h4>
            <small class="text-muted">Total submitted</small>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h6 class="text-muted mb-3">Payments</h6>
            <h4 class="mb-0">{{ statistics.payments?.total || 0 }}</h4>
            <small class="text-muted">Completed transactions</small>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <h6 class="text-muted mb-3">Platform Fees</h6>
            <h4 class="mb-0">${{ (statistics.revenue?.platformFees || 0) | number:'1.2-2' }}</h4>
            <small class="text-muted">Total collected</small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
